apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ .Release.Name }}-acp
  labels:
    {{- include "acp.labels" . | nindent 4 }}
data:
  config.yaml: |
    server:
      url: {{ .Values.serverURL }}
      {{- with .Values.certificate.cert }}
      certificate:
        cert_path: "/data/acp.crt"
        key_path: "/data/acp.key"
      {{- end }}
    sql:
      {{- with .Values.sql }}
      {{- toYaml . | nindent 6 }}
      {{- else }}
      url: "postgres://root@{{ .Release.Name }}-cockroachdb:26257/defaultdb?sslmode=disable"
      {{- end }}
    hazelcast:
      {{- with .Values.hazelcast }}
      {{- toYaml . | nindent 6 }}
      {{- else }}
      addresses:
      - "{{ .Release.Name }}-hazelcast:5701"
      server_name: "{{ .Release.Name }}-hazelcast"
      username: "dev"
      {{- end }}
    {{- with .Values.features }}
    features:
      {{- toYaml . | nindent 6 }}
    {{- end }}
  {{- with .Values.certificate.cert }}
  acp.crt: {{ . | quote }}
  {{- end }}
  {{- with .Values.certificate.key }}
  acp.key: {{ . | quote }}
  {{- end }}
