{{- if .Values.config.create -}}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "acp.configName" . }}
  labels:
    {{- include "acp.labels" . | nindent 4 }}
data:
  config.yaml: |
    server:
      url: {{ .Values.serverURL }}
      {{- with .Values.certificate.cert }}
      certificate:
        cert_path: "/tls/tls.crt"
        key_path: "/tls/tls.key"
      {{- end }}
    sql:
      {{- with .Values.sql }}
        {{- toYaml . | nindent 6 }}
      {{- else }}
      url: "postgres://root@{{ .Release.Name }}-cockroachdb:26257/defaultdb?sslmode=disable"
      {{- end }}
    hazelcast:
      {{- with .Values.hazelcast }}
        {{- toYaml . | nindent 6 }}
      {{- else }}
      enabled: false
      {{- end }}
    redis:
      {{- with .Values.redis }}
        {{- toYaml . | nindent 6 }}
      {{- else }}
      enabled: true
      addrs:
      - "{{ .Release.Name }}-redis-master:6379"
      {{- end }}
    {{- with .Values.features }}
    features:
      {{- toYaml . | nindent 6 }}
    {{- end }}
  extraconfig.yaml: |
    {{- with .Values.config.data }}
      {{- toYaml . | nindent 4 }}
    {{- end }}
{{- end }}
