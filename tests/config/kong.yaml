image:
  repository: kong
  tag: "2.7"

env:
  prefix: /kong_prefix/
  database: "off"
  plugins: "bundled, acp"

admin:
  enabled: true
  http:
    enabled: true
    servicePort: 8001
    containerPort: 8001

ingressController:
  enabled: false
  installCRDs: false

deployment:
  initContainers:
  - name: plugin-setup
    image: imolein/luarocks:5.1
    command: ['sh', '-c', 'luarocks download kong-plugin-acp 1.0.0-1 && luarocks unpack kong-plugin-acp && mv kong-plugin-acp-*/acp-kong-plugin/src/kong/plugins/acp/* /opt/acp']
    volumeMounts:
      - name: "custom-kong-plugin-acp"
        mountPath: "/opt/acp"
  userDefinedVolumes:
  - name: "custom-kong-plugin-acp"
    emptyDir: {}
  userDefinedVolumeMounts:
  - name: "custom-kong-plugin-acp"
    mountPath: "/usr/local/share/lua/5.1/kong/plugins/acp"

dblessConfig:
  config: |
    _format_version: "1.1"
    services:
      - name: httpbin-service
        url: https://httpbin.org
        routes:
        - name: deny
          paths:
          - "/deny"
          methods:
          - "GET"
          - "PATCH"
          - "POST"
          - "DELETE"
          strip_path: false
        - name: headers
          paths:
          - "/headers"
          methods:
          - "GET"
          - "PATCH"
          - "POST"
          - "DELETE"
          strip_path: false
        plugins:
        - name: acp
          config:
            api_group_id: httpbin-service
            auth_url: https://kong-authorizer.kong-authorizer:9003/authorize
            ssl_verify: false